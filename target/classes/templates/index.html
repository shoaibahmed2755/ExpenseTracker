<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Expense Tracker</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background: #f5f6fa;
        }
        .card {
            border-radius: 12px;
        }
        .summary-card h3 {
            font-weight: bold;
        }
        .income-text {
            color: #28a745;
            font-weight: bold;
        }
        .expense-text {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold">Expense Tracker</a>
        <a href="/export/pdf" class="btn btn-outline-light btn-sm">Export PDF</a>
    </div>
</nav>

<div class="container mt-4">

    <!-- SUMMARY CARDS -->
    <div class="row g-3">
        <div class="col-md-3">
            <div class="card text-bg-success summary-card">
                <div class="card-body">
                    <h6>Total Income</h6>
                    <h3 th:text="${income}">0</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-bg-danger summary-card">
                <div class="card-body">
                    <h6>Total Expense</h6>
                    <h3 th:text="${expense}">0</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-bg-primary summary-card">
                <div class="card-body">
                    <h6>Balance</h6>
                    <h3 th:text="${balance}">0</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-bg-warning summary-card">
                <div class="card-body">
                    <h6>Remaining Budget</h6>
                    <h3 th:text="${remaining}">0</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="row mt-4 g-4">

        <!-- LEFT SIDE: Add Expense + Budget -->
        <div class="col-md-5">

            <!-- ADD TRANSACTION CARD -->
            <div class="card shadow-sm">
                <div class="card-header fw-bold">Add Income / Expense</div>
                <div class="card-body">

                    <form th:action="@{/add}" method="post" class="row g-3">
                        <div class="col-12">
                            <input type="text" name="title" placeholder="Title" class="form-control" required>
                        </div>

                        <div class="col-6">
                            <input type="number" step="0.01" name="amount" placeholder="Amount"
                                   class="form-control" required>
                        </div>

                        <div class="col-6">
                            <input type="text" name="category" placeholder="Category"
                                   class="form-control" required>
                        </div>

                        <div class="col-6">
                            <input type="date" name="date" class="form-control" required>
                        </div>

                        <div class="col-6">
                            <select name="type" class="form-select">
                                <option value="EXPENSE">Expense</option>
                                <option value="INCOME">Income</option>
                            </select>
                        </div>

                        <div class="col-12">
                            <button class="btn btn-primary w-100">Add</button>
                        </div>
                    </form>

                </div>
            </div>

            <!-- BUDGET CARD -->
            <div class="card mt-3 shadow-sm">
                <div class="card-header fw-bold">Monthly Budget</div>
                <div class="card-body">
                    <form th:action="@{/budget}" method="post" class="row g-2">
                        <div class="col-8">
                            <input type="number" step="0.01" class="form-control"
                                   name="amount" th:value="${budget}" placeholder="Enter new budget">
                        </div>

                        <div class="col-4">
                            <button class="btn btn-warning w-100">Update</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>

        <!-- RIGHT SIDE: Transaction Table -->
        <div class="col-md-7">

            <div class="card shadow-sm">
                <div class="card-header fw-bold">All Transactions</div>

                <div class="card-body p-0">
                    <table class="table table-striped mb-0">
                        <thead class="table-dark">
                        <tr>
                            <th>Title</th>
                            <th>Amount</th>
                            <th>Category</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr th:each="x : ${list}">
                            <td th:text="${x.title}"></td>

                            <td>
                                <span th:text="${x.amount}"
                                      th:classappend="${x.type} == 'INCOME' ? 'income-text' : 'expense-text'"></span>
                            </td>

                            <td th:text="${x.category}"></td>

                            <td th:text="${x.type}"
                                th:classappend="${x.type} == 'INCOME' ? 'text-success' : 'text-danger'"></td>

                            <td th:text="${x.date}"></td>

                            <td>
                                <a th:href="@{/delete/{id}(id=${x.id})}"
                                   class="btn btn-sm btn-outline-danger">Delete</a>
                            </td>
                        </tr>

                        <tr th:if="${#lists.isEmpty(list)}">
                            <td colspan="6" class="text-center text-muted py-3">
                                No transactions yet.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

    <!-- CHART -->
    <div class="row mt-4">
        <div class="col-md-6">

            <div class="card shadow-sm">
                <div class="card-header fw-bold">
                    Expense Breakdown (Pie Chart)
                </div>
                <div class="card-body">
                    <canvas id="expenseChart" height="200"></canvas>
                </div>
            </div>

        </div>
    </div>

</div>

<!-- CHART SCRIPT -->
<script>
    fetch('/chart-data')
        .then(res => res.json())
        .then(data => {
            const labels = Object.keys(data);
            const amounts = Object.values(data);

            if (labels.length === 0) return;

            new Chart(document.getElementById('expenseChart'), {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: amounts
                    }]
                }
            });
        });
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
